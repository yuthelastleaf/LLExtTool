<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LLExtTool - 视频字幕提取工具</title>
    <link rel="stylesheet" href="styles/main.css">
</head>
<body>
    <div class="app-container">
        <!-- 头部工具栏 -->
        <header class="header">
            <h1>LLExtTool - 视频字幕提取工具</h1>
            <button id="settingsBtn" class="btn btn-secondary">⚙️ 设置</button>
        </header>

        <!-- 主内容区 -->
        <div class="main-content">
            <!-- 左侧：视频和控制面板 -->
            <aside class="sidebar">
                <div class="card">
                    <h2>媒体处理</h2>
                    
                    <div class="form-group">
                        <label>输入文件类型:</label>
                        <div class="file-type-toggle">
                            <button id="videoModeBtn" class="btn btn-toggle active">🎬 视频</button>
                            <button id="audioModeBtn" class="btn btn-toggle">🎵 音频</button>
                        </div>
                    </div>
                    
                    <div class="form-group" id="videoFileGroup">
                        <label>视频文件:</label>
                        <div class="input-group">
                            <input type="text" id="videoPath" readonly placeholder="选择视频文件...">
                            <button id="selectVideoBtn" class="btn btn-primary">选择</button>
                        </div>
                    </div>
                    
                    <div class="form-group hidden" id="audioFileGroup">
                        <label>音频文件:</label>
                        <div class="input-group">
                            <input type="text" id="audioPath" readonly placeholder="选择音频文件...">
                            <button id="selectAudioBtn" class="btn btn-primary">选择</button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>源语言:</label>
                        <select id="sourceLanguage">
                            <option value="ja">日语 (ja)</option>
                            <option value="en">英语 (en)</option>
                            <option value="zh">中文 (zh)</option>
                            <option value="ko">韩语 (ko)</option>
                            <option value="fr">法语 (fr)</option>
                            <option value="de">德语 (de)</option>
                            <option value="es">西班牙语 (es)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>目标语言:</label>
                        <select id="targetLanguage">
                            <option value="zh" selected>中文 (zh)</option>
                            <option value="ja">日语 (ja)</option>
                            <option value="en">英语 (en)</option>
                            <option value="ko">韩语 (ko)</option>
                            <option value="fr">法语 (fr)</option>
                            <option value="de">德语 (de)</option>
                            <option value="es">西班牙语 (es)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>音频格式:</label>
                        <select id="audioFormat">
                            <option value="wav" selected>WAV</option>
                            <option value="mp3">MP3</option>
                        </select>
                    </div>

                    <button id="processBtn" class="btn btn-success btn-large" disabled>
                        开始处理
                    </button>

                    <div id="statusPanel" class="status-panel hidden">
                        <div class="status-message"></div>
                        <div class="progress-bar">
                            <div class="progress-fill"></div>
                        </div>
                        <div class="status-percentage">0%</div>
                    </div>
                </div>

                <div class="card">
                    <h3>视频信息</h3>
                    <div id="videoInfo" class="video-info">
                        <p>未选择视频</p>
                    </div>
                </div>
            </aside>

            <!-- 右侧：字幕编辑器 -->
            <main class="editor-area">
                <div class="editor-header">
                    <h2>字幕编辑器</h2>
                    <div class="editor-actions">
                        <div class="view-mode-toggle">
                            <button id="editModeBtn" class="btn btn-toggle active">✏️ 编辑</button>
                            <button id="overviewModeBtn" class="btn btn-toggle">📋 总览</button>
                        </div>
                        <button id="importBtn" class="btn btn-secondary">📥 导入字幕</button>
                        <button id="importAudioBtn" class="btn btn-secondary">🎵 导入音频</button>
                        <button id="exportBtn" class="btn btn-primary" disabled>💾 导出字幕</button>
                    </div>
                </div>

                <!-- 三段式编辑区域 -->
                <div class="editor-container" id="editModeContainer">
                    <!-- 1. 波形显示区 -->
                    <div class="waveform-section">
                        <div class="waveform-header">
                            <span class="section-title">🎵 音频波形</span>
                            <div class="waveform-controls">
                                <button id="playPauseBtn" class="icon-btn" disabled>▶️</button>
                                <span id="currentTime">0:00</span> / <span id="totalDuration">0:00</span>
                                <button id="zoomInBtn" class="icon-btn">🔍+</button>
                                <button id="zoomOutBtn" class="icon-btn">🔍-</button>
                            </div>
                        </div>
                        <div class="waveform-canvas-container">
                            <canvas id="waveformCanvas" width="800" height="120"></canvas>
                            <div id="waveformPlaceholder" class="waveform-placeholder">
                                <p>音频波形将在处理视频后显示</p>
                            </div>
                        </div>
                        <div class="timeline-ruler" id="timelineRuler"></div>
                    </div>

                    <!-- 2. 文本编辑区 -->
                    <div class="text-editor-section">
                        <div class="text-editor-header">
                            <span class="section-title">✏️ 字幕文本</span>
                            <div class="text-editor-controls">
                                <button id="toggleOriginalBtn" class="icon-btn" title="显示/隐藏原文">
                                    <span class="show-icon">👁️</span>
                                </button>
                                <button id="prevSegmentBtn" class="icon-btn" disabled>◀️</button>
                                <span id="segmentCounter">0 / 0</span>
                                <button id="nextSegmentBtn" class="icon-btn" disabled>▶️</button>
                            </div>
                        </div>
                        <div class="text-editor-content" id="textEditorContent">
                            <div class="empty-state">
                                <p>暂无字幕数据</p>
                                <p class="hint">选择视频并点击"开始处理"生成字幕</p>
                            </div>
                        </div>
                    </div>

                    <!-- 3. 角色分配区 -->
                    <div class="role-assignment-section">
                        <div class="role-header">
                            <span class="section-title">👥 角色分配</span>
                            <button id="addRoleBtn" class="icon-btn add-role-btn" title="添加角色">➕</button>
                        </div>
                        <div class="role-list" id="roleList">
                            <!-- 角色项将动态生成 -->
                        </div>
                    </div>
                </div>

                <!-- 总览模式区域 -->
                <div class="overview-container hidden" id="overviewModeContainer">
                    <div class="overview-toolbar">
                        <div class="overview-search">
                            <input type="text" id="overviewSearchInput" placeholder="🔍 搜索字幕内容...">
                        </div>
                        <div class="overview-filters">
                            <select id="speakerFilter">
                                <option value="">全部说话人</option>
                            </select>
                        </div>
                        <div class="overview-view-options">
                            <button id="toggleOriginalInOverview" class="btn btn-toggle" title="显示/隐藏原文">
                                👁️ 显示原文
                            </button>
                        </div>
                    </div>
                    <div class="overview-table-container">
                        <table class="overview-table">
                            <thead>
                                <tr>
                                    <th class="col-time">时间戳</th>
                                    <th class="col-speaker">说话人角色</th>
                                    <th class="col-original hidden">源文本 (Original)</th>
                                    <th class="col-translation">目标文本翻译</th>
                                </tr>
                            </thead>
                            <tbody id="overviewTableBody">
                                <tr class="empty-row">
                                    <td colspan="4">
                                        <div class="empty-state">
                                            <p>暂无字幕数据</p>
                                            <p class="hint">选择视频并点击"开始处理"生成字幕</p>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- 设置对话框 -->
    <div id="settingsModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>设置</h2>
                <button class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Whisper 模型路径:</label>
                    <div class="input-group">
                        <input type="text" id="whisperModelPath" placeholder="选择模型文件...">
                        <button id="selectWhisperModelBtn" class="btn btn-secondary">浏览</button>
                    </div>
                </div>

                <div class="form-group">
                    <label>翻译模型路径 (目录):</label>
                    <div class="input-group">
                        <input type="text" id="translationModelPath" placeholder="选择模型目录...">
                        <button id="selectTranslationModelBtn" class="btn btn-secondary">浏览</button>
                    </div>
                    <small style="color: #666; margin-top: 4px; display: block;">选择包含 model.bin 和 config.json 的目录</small>
                </div>

                <div class="form-group">
                    <label>翻译 Tokenizer 路径:</label>
                    <div class="input-group">
                        <input type="text" id="translationTokenizerPath" placeholder="选择 tokenizer 文件...">
                        <button id="selectTokenizerBtn" class="btn btn-secondary">浏览</button>
                    </div>
                    <small style="color: #666; margin-top: 4px; display: block;">选择 sentencepiece.bpe.model 文件</small>
                </div>

                <div class="form-group">
                    <label>翻译模型类型:</label>
                    <select id="translationModelType">
                        <option value="m2m100">M2M100 (100+ 语言, 语言代码: __ja__, __zh__)</option>
                        <option value="nllb">NLLB-200 (200 语言, 语言代码: jpn_Jpan, zho_Hans)</option>
                    </select>
                    <small style="color: #666; margin-top: 4px; display: block;">根据你的模型选择对应的类型,影响语言代码格式</small>
                </div>

                <div class="form-group">
                    <label>输出目录:</label>
                    <div class="input-group">
                        <input type="text" id="outputDirectory" placeholder="选择输出目录...">
                        <button id="selectOutputDirBtn" class="btn btn-secondary">浏览</button>
                    </div>
                </div>

                <hr style="margin: 20px 0; border: none; border-top: 1px solid #ddd;">

                <div class="form-group">
                    <button id="reloadTranslationBtn" class="btn btn-success" style="width: 100%;">
                        🔄 重新加载翻译模型
                    </button>
                    <small style="color: #666; margin-top: 4px; display: block;">使用新配置的路径重新加载模型，无需重启应用</small>
                </div>

                <hr style="margin: 20px 0; border: none; border-top: 1px solid #ddd;">

                <h3 style="margin-bottom: 15px; font-size: 16px;">语言支持</h3>

                <div class="form-group">
                    <label>默认源语言:</label>
                    <select id="defaultSourceLanguage">
                        <option value="ja">日语 (ja)</option>
                        <option value="en">英语 (en)</option>
                        <option value="zh">中文 (zh)</option>
                        <option value="ko">韩语 (ko)</option>
                        <option value="fr">法语 (fr)</option>
                        <option value="de">德语 (de)</option>
                        <option value="es">西班牙语 (es)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>默认目标语言:</label>
                    <select id="defaultTargetLanguage">
                        <option value="zh">中文 (zh)</option>
                        <option value="ja">日语 (ja)</option>
                        <option value="en">英语 (en)</option>
                        <option value="ko">韩语 (ko)</option>
                        <option value="fr">法语 (fr)</option>
                        <option value="de">德语 (de)</option>
                        <option value="es">西班牙语 (es)</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button id="saveSettingsBtn" class="btn btn-primary">保存</button>
                <button id="cancelSettingsBtn" class="btn btn-secondary">取消</button>
            </div>
        </div>
    </div>

    <!-- 添加说话人对话框 -->
    <div id="addSpeakerModal" class="modal hidden">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h2>添加说话人</h2>
                <button class="close-btn" id="closeSpeakerModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>说话人名称:</label>
                    <input type="text" id="speakerNameInput" placeholder="请输入说话人名称...">
                </div>
            </div>
            <div class="modal-footer">
                <button id="confirmAddSpeaker" class="btn btn-primary">确定</button>
                <button id="cancelAddSpeaker" class="btn btn-secondary">取消</button>
            </div>
        </div>
    </div>

    <!-- 添加角色对话框 -->
    <div id="addRoleModal" class="modal hidden">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h2>添加角色</h2>
                <button class="close-btn" id="closeRoleModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>角色名称:</label>
                    <input type="text" id="roleNameInput" placeholder="请输入角色名称...">
                </div>
            </div>
            <div class="modal-footer">
                <button id="confirmAddRole" class="btn btn-primary">确定</button>
                <button id="cancelAddRole" class="btn btn-secondary">取消</button>
            </div>
        </div>
    </div>

    <script>
        // 为 CommonJS 模块提供全局对象
        if (typeof exports === 'undefined') {
            var exports = {};
        }
        if (typeof module === 'undefined') {
            var module = { exports: exports };
        }
    </script>
    <script src="renderer.js"></script>
</body>
</html>
