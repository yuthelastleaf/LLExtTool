# é—®é¢˜ä¿®å¤ç¡®è®¤æ¸…å•

## âœ… å·²ä¿®å¤çš„é”™è¯¯

### 1. DOM å…ƒç´ å¼•ç”¨é”™è¯¯
**é”™è¯¯ä¿¡æ¯**ï¼š
```
TypeError: Cannot read properties of null (reading 'addEventListener')
at setupEventListeners (renderer.ts:109:28)
```

**åŸå› **ï¼š
- `elements.addSpeakerBtn` å¼•ç”¨äº†ä¸å­˜åœ¨çš„ DOM å…ƒç´ 
- HTML ä¸­å·²æ”¹åä¸º `addRoleBtn`ï¼Œä½† TypeScript ä¸­ä»ä½¿ç”¨æ—§åç§°
- `elements.subtitleList` å·²ä¸å†ä½¿ç”¨ä½†ä»åœ¨ elements å¯¹è±¡ä¸­

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ä» `elements` å¯¹è±¡ä¸­ç§»é™¤ `addSpeakerBtn` å¼•ç”¨
2. ä» `elements` å¯¹è±¡ä¸­ç§»é™¤ `subtitleList` å¼•ç”¨  
3. ä» `setupEventListeners` ä¸­ç§»é™¤å¯¹åº”çš„äº‹ä»¶ç›‘å¬å™¨
4. è¿™äº›åŠŸèƒ½å·²åœ¨ `initNewEditor()` ä¸­é‡æ–°å®ç°

## æµ‹è¯•æ­¥éª¤

### æµ‹è¯• 1: åº”ç”¨å¯åŠ¨
- [x] åº”ç”¨æ­£å¸¸å¯åŠ¨ï¼Œæ— æŠ¥é”™
- [x] æ§åˆ¶å°æ˜¾ç¤ºåˆå§‹åŒ–æ—¥å¿—
- [x] ç•Œé¢æ­£å¸¸æ˜¾ç¤º

### æµ‹è¯• 2: å·¦å³åˆ‡æ¢æŒ‰é’®
è¿è¡Œåº”ç”¨åï¼š
1. é€‰æ‹©è§†é¢‘æ–‡ä»¶
2. ç‚¹å‡»"å¼€å§‹å¤„ç†"
3. ç­‰å¾…å¤„ç†å®Œæˆ
4. æµ‹è¯•ä»¥ä¸‹åŠŸèƒ½ï¼š
   - [ ] ç‚¹å‡» â—€ï¸ æŒ‰é’®åˆ‡æ¢åˆ°ä¸Šä¸€æ®µ
   - [ ] ç‚¹å‡» â–¶ï¸ æŒ‰é’®åˆ‡æ¢åˆ°ä¸‹ä¸€æ®µ
   - [ ] ç¬¬ä¸€æ®µæ—¶ â—€ï¸ æŒ‰é’®åº”è¯¥ç¦ç”¨
   - [ ] æœ€åä¸€æ®µæ—¶ â–¶ï¸ æŒ‰é’®åº”è¯¥ç¦ç”¨
   - [ ] æ§åˆ¶å°æ˜¾ç¤º `[Editor] Previous/Next segment clicked`

### æµ‹è¯• 3: æ·»åŠ è§’è‰²æŒ‰é’®
1. å¤„ç†è§†é¢‘å
2. ç‚¹å‡»å³ä¸‹è§’ â• æŒ‰é’®
3. åº”è¯¥å¼¹å‡ºè¾“å…¥æ¡†
4. è¾“å…¥è§’è‰²åç§°ï¼ˆå¦‚"æ—ç™½"ï¼‰
5. ç‚¹å‡»ç¡®å®š
6. æµ‹è¯•ï¼š
   - [ ] è¾“å…¥æ¡†æ­£å¸¸å¼¹å‡º
   - [ ] æ–°è§’è‰²å‡ºç°åœ¨åˆ—è¡¨ä¸­
   - [ ] æ§åˆ¶å°æ˜¾ç¤º `[Editor] Add role clicked`
   - [ ] æ§åˆ¶å°æ˜¾ç¤º `[Editor] Role added: æ—ç™½`

### æµ‹è¯• 4: éŸ³é¢‘æ³¢å½¢
1. å¤„ç†è§†é¢‘å
2. æ£€æŸ¥é¡¶éƒ¨æ³¢å½¢åŒºåŸŸ
3. æµ‹è¯•ï¼š
   - [ ] æ˜¾ç¤ºè“è‰²éŸ³é¢‘æ³¢å½¢
   - [ ] æ§åˆ¶å°æ˜¾ç¤º `[Waveform] Audio loaded successfully`
   - [ ] æ§åˆ¶å°æ˜¾ç¤º `[Waveform] Audio decoded successfully`

### æµ‹è¯• 5: åŸæ–‡æ˜¾ç¤º/éšè—
1. å¤„ç†è§†é¢‘å
2. ç‚¹å‡» ğŸ‘ï¸ æŒ‰é’®
3. æµ‹è¯•ï¼š
   - [ ] ç‚¹å‡»åæ˜¾ç¤ºåŸæ–‡æ¡†
   - [ ] å†æ¬¡ç‚¹å‡»éšè—åŸæ–‡æ¡†
   - [ ] æ§åˆ¶å°æ˜¾ç¤º `[Editor] Toggle original text clicked`

## è°ƒè¯•æ—¥å¿—æ£€æŸ¥

æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰ï¼Œåº”è¯¥çœ‹åˆ°ä»¥ä¸‹æ—¥å¿—ï¼š

### åˆå§‹åŒ–é˜¶æ®µ
```
[Renderer] ========== å¼€å§‹åˆå§‹åŒ– ==========
[Renderer] init() å‡½æ•°è¢«è°ƒç”¨
[Renderer] âœ“ å·²ç»‘å®š selectVideoBtn ç‚¹å‡»äº‹ä»¶
[Renderer] âœ“ å·²ç»‘å®š processBtn ç‚¹å‡»äº‹ä»¶
[Renderer] âœ“ å·²ç»‘å®š exportBtn ç‚¹å‡»äº‹ä»¶
[Renderer] âœ“ å·²ç»‘å®š settingsBtn ç‚¹å‡»äº‹ä»¶
[Renderer] ========== åˆå§‹åŒ–å®Œæˆ ==========
[Editor] Initializing new editor...
[Editor] Buttons found: {toggleOriginal: true, prev: true, next: true, addRole: true}
```

### å¤„ç†è§†é¢‘å
```
[Renderer] Audio extracted to: ...
[Renderer] Loading audio for waveform...
[Waveform] Loading audio from: ...
[Waveform] AudioContext created
[Waveform] File read, size: ...
[Waveform] Audio decoded successfully, duration: ...
```

### æŒ‰é’®ç‚¹å‡»
```
[Editor] Previous segment clicked, current index: X
[Editor] Next segment clicked, current index: X
[Editor] Add role clicked
[Editor] Role added: è§’è‰²å - Total roles: X
[Editor] Toggle original text clicked
```

## å¸¸è§é—®é¢˜æ’æŸ¥

### Q: æŒ‰é’®è¿˜æ˜¯æ²¡ååº”ï¼Ÿ
A: æ£€æŸ¥æ§åˆ¶å° `[Editor] Buttons found` æ—¥å¿—ï¼Œç¡®ä¿æ‰€æœ‰æŒ‰é’®éƒ½æ˜¯ `true`

### Q: æ³¢å½¢ä¸æ˜¾ç¤ºï¼Ÿ
A: 
1. ç¡®è®¤éŸ³é¢‘æå–æˆåŠŸï¼ˆæŸ¥çœ‹ `[Renderer] Audio extracted to` æ—¥å¿—ï¼‰
2. ç¡®è®¤éŸ³é¢‘åŠ è½½æˆåŠŸï¼ˆæŸ¥çœ‹ `[Waveform] Audio decoded successfully` æ—¥å¿—ï¼‰
3. æ£€æŸ¥æ˜¯å¦æœ‰éŸ³é¢‘æ ¼å¼é”™è¯¯

### Q: æ§åˆ¶å°æœ‰å…¶ä»–é”™è¯¯ï¼Ÿ
A: æä¾›å®Œæ•´çš„é”™è¯¯ä¿¡æ¯ä»¥ä¾¿è¿›ä¸€æ­¥è¯Šæ–­

## ä»£ç å˜æ›´æ‘˜è¦

### ä¿®æ”¹çš„æ–‡ä»¶
- `src/renderer/renderer.ts`

### ä¸»è¦å˜æ›´
1. **ç§»é™¤è¿‡æ—¶çš„ DOM å¼•ç”¨**
   ```typescript
   // ç§»é™¤
   subtitleList: document.getElementById('subtitleList'),
   addSpeakerBtn: document.getElementById('addSpeakerBtn'),
   ```

2. **ç§»é™¤è¿‡æ—¶çš„äº‹ä»¶ç›‘å¬å™¨**
   ```typescript
   // ç§»é™¤
   elements.addSpeakerBtn.addEventListener('click', addSpeaker);
   ```

3. **ä¿ç•™çš„åŠŸèƒ½**
   - `initNewEditor()` - å¤„ç†æ‰€æœ‰æ–°ç¼–è¾‘å™¨çš„äº‹ä»¶
   - `renderCurrentSegment()` - æ¸²æŸ“å½“å‰å­—å¹•æ®µ
   - `renderRoles()` - æ¸²æŸ“è§’è‰²åˆ—è¡¨
   - `drawWaveformForSegment()` - ç»˜åˆ¶æ³¢å½¢
   - `loadAudioForWaveform()` - åŠ è½½éŸ³é¢‘

## ä¸‹ä¸€æ­¥

å¦‚æœæ‰€æœ‰æµ‹è¯•éƒ½é€šè¿‡ï¼Œå¯ä»¥ç»§ç»­ï¼š
1. å®ç°éŸ³é¢‘æ’­æ”¾åŠŸèƒ½
2. å®ç°æ³¢å½¢ç¼©æ”¾åŠŸèƒ½
3. æ·»åŠ é”®ç›˜å¿«æ·é”®
4. ä¼˜åŒ–æ³¢å½¢æ€§èƒ½
