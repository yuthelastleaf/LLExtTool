# 新三段式编辑器说明

## 界面布局

新的编辑器采用三段式垂直布局，类似专业音视频编辑软件：

### 1. 波形显示区（顶部，180px）
- 📊 **音频波形可视化**：显示当前字幕段对应的音频波形
- 🎮 **播放控制**：播放/暂停按钮、时间显示
- 🔍 **缩放功能**：放大/缩小波形以便精确编辑
- ⏱️ **时间轴标尺**：显示时间刻度

**特性**：
- 黑色背景，蓝色波形（#4a9eff）
- 根据当前选中的字幕段自动更新波形显示
- 支持波形缩放以便精确查看

### 2. 文本编辑区（中部，自适应）
- ✏️ **译文编辑**：主要编辑区域，显示翻译后的文本
- 👁️ **原文显示**：点击眼睛图标切换显示/隐藏原文
- ⏮️⏭️ **段落导航**：上一段/下一段按钮快速切换
- 📍 **时间信息**：显示当前段落的时间范围和序号

**特性**：
- 大字号文本框，便于编辑
- 原文以灰色背景框显示，不可编辑
- 实时保存修改到内存
- 段落计数器显示当前位置（如 "3 / 15"）

### 3. 角色分配区（底部，120px）
- 👥 **角色列表**：横向滚动的角色按钮列表
- ➕ **添加角色**：右上角加号按钮快速添加新角色
- 🎨 **颜色标识**：每个角色有独特的颜色标识
- ✖️ **删除角色**：自定义角色可删除（预设角色不可删除）

**特性**：
- 预设两个角色：Role A (绿色) 和 Role B (蓝色)
- 点击角色按钮分配给当前字幕段
- 当前选中角色高亮显示
- 胶囊状设计，美观易用

## 使用流程

1. **处理视频**：选择视频文件 → 点击"开始处理"
2. **查看结果**：处理完成后自动显示第一段字幕
3. **编辑字幕**：
   - 在文本框中编辑译文
   - 点击眼睛图标查看原文
   - 使用 ◀️ ▶️ 按钮切换段落
4. **分配角色**：
   - 添加自定义角色（如"角色C"、"旁白"等）
   - 点击对应角色按钮为当前段落分配说话人
5. **导出字幕**：编辑完成后点击"💾 导出字幕"

## 快捷操作

- **显示/隐藏原文**：点击 👁️ 按钮
- **切换段落**：使用 ◀️ ▶️ 按钮或键盘方向键（待实现）
- **添加角色**：点击角色区域的 ➕ 按钮
- **分配角色**：直接点击角色胶囊按钮

## 技术实现

### 波形绘制
- 使用 Canvas API 绘制波形
- Web Audio API 加载和解析音频文件
- 根据时间段提取对应的音频数据
- 自适应高 DPI 屏幕

### 数据同步
- 所有修改实时保存到 `currentSegments` 数组
- 切换段落时自动保存当前编辑
- 导出时使用最新的编辑数据

### 性能优化
- 只渲染当前可见的字幕段
- 波形数据缓存避免重复计算
- 使用 requestAnimationFrame 优化动画

## 待实现功能

- [ ] 音频播放控制（播放/暂停）
- [ ] 波形点击跳转到对应时间
- [ ] 键盘快捷键支持
- [ ] 拖拽调整字幕时间范围
- [ ] 批量操作（全选、批量分配角色等）
- [ ] 撤销/重做功能
- [ ] 字幕段合并/拆分

## 注意事项

1. **音频波形**：需要先处理视频生成音频文件后才能显示
2. **角色管理**：前两个预设角色不可删除，只能删除自定义添加的角色
3. **数据保存**：目前只在内存中保存，导出前不会丢失，但关闭应用会丢失未导出的修改
4. **浏览器兼容性**：使用了 Web Audio API，需要现代浏览器支持
