# 打包错误解决方案

## 错误：Cannot create symbolic link

### 问题描述
```
ERROR: Cannot create symbolic link
cause=exit status 2
```

这是 Windows 上 electron-builder 缓存符号链接权限问题。

### 解决方案

#### 方法 1：以管理员身份运行（推荐）

1. 右键点击 PowerShell 或 VS Code
2. 选择"以管理员身份运行"
3. 重新执行打包命令：
   ```powershell
   npm run package
   ```

#### 方法 2：启用开发者模式（一劳永逸）

Windows 10/11 启用开发者模式后会自动获得符号链接权限：

1. 打开"设置"
2. 进入"更新和安全" → "开发者选项"
3. 开启"开发人员模式"
4. 重启 PowerShell/VS Code
5. 重新打包

#### 方法 3：清理缓存

如果上述方法仍有问题，清理 electron-builder 缓存：

```powershell
# 清理缓存
Remove-Item -Path "$env:LOCALAPPDATA\electron-builder\Cache" -Recurse -Force

# 重新打包
npm run package
```

#### 方法 4：跳过代码签名工具

修改 `package.json`，禁用 Windows 代码签名工具下载：

```json
{
  "build": {
    "win": {
      "signingHashAlgorithms": []
    }
  }
}
```

### 验证修复

打包成功的输出应该是：

```
• building        target=nsis file=release\LLExtTool Setup 1.0.0.exe
• building        target=zip file=release\LLExtTool-1.0.0-win.zip
• building complete
```

### 其他常见打包错误

#### 错误：Module not found

**原因**：native 模块未正确编译

**解决**：
```powershell
npx electron-rebuild
npm run package
```

#### 错误：ENOENT: no such file or directory

**原因**：缺少必需文件

**解决**：
```powershell
# 检查缺失文件
powershell -ExecutionPolicy Bypass -File .\scripts\prepare-package.ps1

# 重新编译
npm run build
npx electron-rebuild
npm run package
```

#### 错误：Cannot find module 'electron'

**原因**：依赖未安装

**解决**：
```powershell
npm install
npm run package
```

### 完整打包流程（避免错误）

```powershell
# 1. 清理
npm run clean
Remove-Item -Path "$env:LOCALAPPDATA\electron-builder\Cache" -Recurse -Force -ErrorAction SilentlyContinue

# 2. 安装依赖
npm install

# 3. 编译
npm run build

# 4. 重新编译 native 模块
npx electron-rebuild

# 5. 检查准备
powershell -ExecutionPolicy Bypass -File .\scripts\prepare-package.ps1

# 6. 打包（以管理员身份）
npm run package
```

### 绿色版打包（避免符号链接问题）

如果持续遇到符号链接问题，可以只打包 ZIP 版本：

修改 `package.json`：

```json
{
  "scripts": {
    "package:portable": "npm run build && electron-builder --win --x64 zip"
  }
}
```

然后运行：
```powershell
npm run package:portable
```

这样只生成绿色版 ZIP，避免 NSIS 安装包相关的符号链接问题。
