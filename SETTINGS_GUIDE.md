# 翻译功能设置指南

## 新增功能

### 1. 设置界面增强

在设置对话框中新增以下配置项：

#### 翻译模型配置
- **翻译模型路径（目录）**：选择包含 `model.bin` 和 `config.json` 的 CTranslate2 模型目录
  - 默认：`native/model/m2m100-ct2`
  - 点击"浏览"按钮选择文件夹

- **翻译 Tokenizer 路径**：选择 SentencePiece tokenizer 文件
  - 默认：`native/model/m2m100_418M/sentencepiece.bpe.model`
  - 点击"浏览"按钮选择 `.model` 文件

#### 语言支持配置
- **默认源语言**：设置转录的默认语言
  - 可选：日语、英语、中文、韩语、法语、德语、西班牙语
  
- **默认目标语言**：设置翻译的默认目标语言
  - 可选：中文、日语、英语、韩语、法语、德语、西班牙语

### 2. 主界面语言选项增强

#### 源语言选择
现在支持 7 种语言：
- 日语 (ja)
- 英语 (en)
- 中文 (zh)
- 韩语 (ko)
- 法语 (fr)
- 德语 (de)
- 西班牙语 (es)

#### 目标语言选择
同样支持 7 种语言，可以自由组合进行翻译

## 使用流程

### 初次配置

1. **打开设置界面**
   - 点击右上角"⚙️ 设置"按钮

2. **配置 Whisper 模型**
   - 在"Whisper 模型路径"字段选择模型文件（.bin）

3. **配置翻译模型**
   - 在"翻译模型路径（目录）"选择模型目录
     - 例如：`F:\GitProject\LLExtTool\native\model\m2m100-ct2`
   - 在"翻译 Tokenizer 路径"选择 tokenizer 文件
     - 例如：`F:\GitProject\LLExtTool\native\model\m2m100_418M\sentencepiece.bpe.model`

4. **设置默认语言**
   - 选择常用的源语言（如"日语"）
   - 选择常用的目标语言（如"中文"）

5. **保存设置**
   - 点击"保存"按钮
   - 系统会提示重启应用以加载新模型

6. **重启应用**
   - 关闭并重新打开应用
   - 模型会在启动时自动加载

### 日常使用

1. **选择输入文件**
   - 切换到"🎬 视频"或"🎵 音频"模式
   - 点击"选择"按钮选择文件

2. **设置语言对**
   - 在"源语言"下拉框选择原始语言
   - 在"目标语言"下拉框选择翻译目标语言
   - 支持任意语言对组合（如 日→中、英→日、中→英 等）

3. **开始处理**
   - 点击"开始处理"按钮
   - 系统会自动完成：
     1. 提取音频
     2. Whisper 转录
     3. M2M100 翻译
     4. 生成双语字幕

4. **导出结果**
   - 点击"💾 导出字幕"按钮
   - 选择格式（SRT/VTT/JSON）
   - 保存双语字幕文件

## 支持的语言对示例

### 常用翻译方向
- 🇯🇵 日语 → 🇨🇳 中文
- 🇬🇧 英语 → 🇨🇳 中文
- 🇬🇧 英语 → 🇯🇵 日语
- 🇨🇳 中文 → 🇬🇧 英语
- 🇯🇵 日语 → 🇬🇧 英语
- 🇰🇷 韩语 → 🇨🇳 中文

### 欧洲语言
- 🇫🇷 法语 → 🇬🇧 英语
- 🇩🇪 德语 → 🇬🇧 英语
- 🇪🇸 西班牙语 → 🇬🇧 英语

## 技术细节

### M2M100 语言代码
系统会自动将 UI 的语言代码转换为 M2M100 格式：
- `ja` → `__ja__`
- `en` → `__en__`
- `zh` → `__zh__`
- `ko` → `__ko__`
- `fr` → `__fr__`
- `de` → `__de__`
- `es` → `__es__`

### 翻译参数
默认翻译参数：
```javascript
{
  target_prefix: ['__zh__'],  // 根据目标语言自动设置
  beam_size: 4,               // 搜索束大小
  max_batch_size: 32,         // 批量大小
  length_penalty: 1           // 长度惩罚
}
```

### 性能
- **GPU 加速**：使用 CUDA 加速推理
- **批量处理**：一次处理最多 32 个字幕片段
- **平均速度**：约 1-2 秒/批次（取决于显卡性能）

## 故障排除

### 问题：保存设置后翻译不工作
**解决方案**：
1. 确认已重启应用
2. 检查模型路径是否正确
3. 查看启动日志是否有错误

### 问题：找不到模型文件
**解决方案**：
1. 确认模型目录包含 `model.bin` 和 `config.json`
2. 确认 tokenizer 文件是 `.model` 格式
3. 使用绝对路径而不是相对路径

### 问题：某些语言对翻译质量不佳
**解决方案**：
1. M2M100 对某些语言对支持更好（如英语、中文、日语）
2. 可以尝试调整 `beam_size` 参数（在代码中）
3. 考虑使用专门的语言对模型（如 OPUS-MT）

## 更新日志

### v0.1.0 (2025-11-18)
- ✅ 添加翻译模型目录配置
- ✅ 添加 Tokenizer 文件路径配置
- ✅ 添加默认源语言/目标语言设置
- ✅ 扩展支持 7 种语言
- ✅ 主界面语言选项同步更新
- ✅ 保存设置后提示重启应用

## 下一步计划

- [ ] 添加翻译质量参数配置（beam_size, length_penalty）
- [ ] 添加模型状态指示器（已加载/未加载）
- [ ] 支持更多语言（M2M100 支持 100+ 种语言）
- [ ] 添加翻译缓存功能
- [ ] 支持自定义语言对

---

**提示**：首次使用请务必在设置中正确配置翻译模型路径和 Tokenizer 路径，并重启应用！
